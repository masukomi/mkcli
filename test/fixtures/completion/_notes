#compdef notes
_notes(){
  local context="$curcontext" state state_descr line ret=1;
  typeset -A opt_args;
  local actions options commands;

  options=(
    "(-p --package)"{-p=,--package=}"[File type completion]:file:_files -g '*.json'" 
    "(-f --file)"{-f=,--file=}"[File completion]:file:_files" 
    "(-d --directory)"{-d=,--directory=}"[Directory completion]:directory:_directories" 
    "(-H --host)"{-H=,--host=}"[Host completion]:host:_hosts" 
    "*"{-D=,--domain=}"[Domain completion]:domain:_domains" 
    "*"{-u=,--url=}"[URL completion]:url:_urls" 
    "(-h --help)"{-h,--help}"[Display help and exit]" 
    "--version[Print version and exit]"
  )

  actions=(
    "*:file:_files -g '*.md'"
  )

  _arguments \
    "1:cmd:->cmd" \
    "*::arg:->args" && ret=0;

  case $state in
    (cmd)
      commands=(
        "add:Add a note" 
        "del:Delete a note" 
        "list:List notes" 
        "show:Show a note" 
        "edit:Edit a note"
      )
      _describe "notes commands" commands && ret=0
      ;;
    (args)
      case "$words[1]" in
        add)
          _arguments \
            "(-t --type)"{-t=,--type=}"[Type of note to create]:value:_values select  'todo' 'bug' 'feature'" \
            $options \
            $actions && ret=0;
        ;;
        del)
          _arguments \
            $options \
            $actions && ret=0;
        ;;
        ls|list)

          _arguments \
            "1:cmd:->cmd" \
            "*::arg:->args" && ret=0;

          case $state in
            (cmd)
              commands=(
                "todo:Show todos" 
                "bug:Show bugs" 
                "feature:Show features"
              )
              _describe "list commands" commands && ret=0
              _arguments \
                $options \
                $actions && return 0;
              ;;
            (args)
              case "$words[1]" in
                todo)
                  _arguments \
                    $options \
                    $actions && ret=0;
                ;;
                bug)
                  _arguments \
                    $options \
                    $actions && ret=0;
                ;;
                feature)
                  _arguments \
                    $options \
                    $actions && ret=0;
                ;;
              esac
              ;;
          esac
        ;;
        show)
          _arguments \
            $options \
            $actions && ret=0;
        ;;
        edit)
          _arguments \
            $options \
            $actions && ret=0;
        ;;
      esac
      ;;
  esac
  return $ret;
}

_notes "$@"